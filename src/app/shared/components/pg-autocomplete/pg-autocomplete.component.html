<div class="autocomplete-container position-relative" (click)="hideDropdown($event)">
    <input type="text" #searchInput autocomplete="off" [placeholder]="placeholder" class="form-control"
        [(ngModel)]="searchTerm" (input)="onSearchChange($event)" (keydown)="onKeyDown($event)" (focus)="onFocus()"
        (blur)="onBlur()" />

    <!-- Botón de limpieza (X) -->
    @if (searchTerm) {
    <button class="clear-btn" type="button" (click)="clearSearch()">
        ✖
    </button>
    }

    @if (showDropdown) {
    <ul #suggestionsList class="dropdown-menu show autocomplete-menu">
        <!-- Indicador de carga -->
        @if (isLoading) {
        @if (loadingTemplate) {
        <ng-container [ngTemplateOutlet]="loadingTemplate"></ng-container>
        } @else {
        <li class="dropdown-item loading-item">
            <div class="d-flex align-items-center">
                <div class="spinner-border spinner-border-sm text-primary me-2" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
                <span>Buscando...</span>
            </div>
        </li>
        }
        }

        <!-- Resultados -->
        @if (!isLoading && filteredSuggestions.length > 0) {
        @for (item of filteredSuggestions; track item; let i = $index) {
        <li class="dropdown-item" [class.active]="i === selectedIndex" (click)="selectItem(item)">
            @if (itemTemplate) {
            <ng-container [ngTemplateOutlet]="itemTemplate"
                [ngTemplateOutletContext]="{ $implicit: item }"></ng-container>
            } @else {
            <span class="suggestion_name">
                {{ formatDisplayText(item) }}
            </span>
            }
        </li>
        }
        }

        <!-- Mensaje cuando no hay resultados -->
        @if (!isLoading && noResults) {
        @if (notFoundTemplate) {
        <ng-container [ngTemplateOutlet]="notFoundTemplate"></ng-container>
        } @else {
        <li class="dropdown-item no-results">
            <div class="text-left py-2">
                <i class="bi bi-search me-2"></i>
                No se encontraron resultados
            </div>
        </li>
        }
        }
    </ul>
    }
</div>